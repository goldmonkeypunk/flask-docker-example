{% extends "base.html" %}
{% block content %}

<h2 class="mb-3">Журнал – {{ days[0].strftime('%B %Y')|capitalize }}</h2>

<div class="d-flex justify-content-between mb-2">
  <a class="btn btn-outline-primary" href="{{ url_for('journal', y=(year if month>1 else year-1),
                                                     m=(month-1 if month>1 else 12)) }}">← попередній</a>
  <a class="btn btn-outline-primary" href="{{ url_for('journal', y=(year if month<12 else year+1),
                                                     m=(month+1 if month<12 else 1)) }}">наступний →</a>
</div>

<table class="table table-bordered align-middle text-center">
  <thead class="table-light">
    <tr>
      <th class="text-start">Учень</th>
      {% for d in days %}
        <th style="width:40px">{{ d.day }}</th>
      {% endfor %}
      <th>₴ / міс.</th>
    </tr>
  </thead>

  <tbody>
    {% for s in students %}
    <tr id="row-{{ s.id }}">
      <td class="text-start">{{ s.name }}</td>
      {% for d in days %}
      {% set iso = d.isoformat() %}
      <td class="att {% if iso in attend[s.id] %}table-success{% endif %}"
          {% if current_user.role=='teacher' %}
            data-stu="{{ s.id }}" data-date="{{ iso }}"
          {% endif %}>
          {% if iso in attend[s.id] %}✓{% endif %}
      </td>
      {% endfor %}
      <td class="month-sum fw-semibold">{{ s.month_sum }}</td>
    </tr>
    {% endfor %}
  </tbody>

  <tfoot>
    <tr class="table-secondary">
      <td colspan="{{ days|length + 1 }}" class="text-end fw-bold">Усього:</td>
      <td id="total">{{ total }}</td>
    </tr>
  </tfoot>
</table>

<script src="{{ url_for('static', filename='app.js') }}" defer></script>
{% endblock %}
