name: 🧹 Прибирання артефактів

on:
  schedule:
    # 5 разів на добу (через кожні 4 години 48 хвилин)
    - cron: '48 */4 * * *'
  workflow_dispatch:

jobs:
  cleanup:
    name: 🗑️ Видалення старих artefact‑ів
    runs-on: ubuntu-latest

    steps:
      - name: 🧮 Знаходимо застарілі artefact‑и
        uses: actions/github-script@v7
        with:
          script: |
            const maxAgeDays = 3
            const cutoff = Date.now() - maxAgeDays*24*60*60*1000
            const { data } = await github.rest.actions.listArtifactsForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              per_page: 100
            })
            const old = data.artifacts.filter(a => new Date(a.created_at).valueOf() < cutoff)
            core.notice(`Старих artefact‑ів: ${old.length}`)
            for (const art of old) {
              core.notice(`🗑️ Видалення #${art.id} (${art.name})`)
              await github.rest.actions.deleteArtifact({
                owner: context.repo.owner,
                repo: context.repo.repo,
                artifact_id: art.id
              })
            }
