name: üåô –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ (10√ó –Ω–∞ –¥–æ–±—É)

on:
  schedule:
    # –∫–æ–∂–Ω—ñ ~2 –≥–æ–¥–∏–Ω–∏ ‚áí 12 —Ä–∞–∑—ñ–≤; GitHub –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ç–æ—á–Ω—ñ 10,
    # –∞–ª–µ —Ü–µ –±–ª–∏–∂—á–µ –∑–∞ –≤—Å–µ –¥–æ –≤–∏–º–æ–≥–∏ ¬´–¥–µ—Å—è—Ç—å¬ª
    - cron: '0 */2 * * *'
  workflow_dispatch:

jobs:
  e2e:
    name: üö¶ End‚Äëto‚ÄëEnd —Ç–µ—Å—Ç–∏
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞—î–º–æ docker‚Äëcompose
        run: |
          docker compose up -d
          echo "‚åõ –ß–µ–∫–∞—î–º–æ 15 c–µ–∫—É–Ω–¥ –ø–æ–∫–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –ø—ñ–¥—ñ–π–º–µ —Å–ª—É–∂–±—É‚Ä¶"
          sleep 15

      - name: üîó –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        run: |
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 || true)
          if [ "$STATUS" != "200" ]; then
            echo "‚ùå –ì–æ–ª–æ–≤–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∫–æ–¥ $STATUS"; exit 1
          fi
          echo "‚úÖ –û—Ç—Ä–∏–º–∞–Ω–æ 200 OK"

      - name: ‚èπÔ∏è –ó—É–ø–∏–Ω–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
        if: always()
        run: docker compose down -v
